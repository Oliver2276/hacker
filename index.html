<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Animación Hacker</title>
  <style>
    body {
      background-color: red;
      color: white;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      user-select: none;
      overflow: hidden;
      position: relative;
      transition: all 1s ease;
      text-align: center;
      padding: 0 10px;
      box-sizing: border-box;
    }

    canvas {
      position: absolute;
      top: 0;
      left: 0;
      z-index: 0;
      width: 100%;
      height: 100%;
    }

    #texto, button {
      z-index: 1;
      position: relative;
    }

    #texto {
      font-size: 4rem;
      white-space: nowrap;
      margin-bottom: 20px;
      transition: font-family 1s ease;
      max-width: 100%;
    }

    button {
      padding: 12px 25px;
      font-size: 1.2rem;
      background-color: #004400;
      border: none;
      border-radius: 100%;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s ease;
      max-width: 100%;
      box-sizing: border-box;
      margin: 5px;
    }

    button:hover:not(:disabled) {
      background-color: #008800;
    }

    button:disabled {
      opacity: 0.5;
      cursor: default;
      text-decoration: line-through;
    }

    @media (max-width: 600px) {
      #texto {
        font-size: 2.5rem;
        white-space: normal;
      }

      button {
        font-size: 1rem;
        padding: 10px 20px;
        width: 100%;
        max-width: 300px;
      }
    }

    #opciones {
      display: none;
      flex-direction: column;
    }
  </style>
</head>
<body>

<canvas id="matrixCanvas"></canvas>
<h1 id="texto">¡Hola, mundo!</h1>
<button id="btnHacker">Hacker</button>

<div id="opciones">
  <button id="btnArreglar">Arreglar todo</button>
  <button id="btnHackearMas">Hackear aún más</button>
</div>

<script>
  const texto = document.getElementById('texto');
  const btnHacker = document.getElementById('btnHacker');
  const btnArreglar = document.getElementById('btnArreglar');
  const btnHackearMas = document.getElementById('btnHackearMas');
  const opciones = document.getElementById('opciones');

  const numbers = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'.split('');
  const binary = ['0', '1'];
  const targetText = 'ESTÁS HACKEADO';
  const preguntaFinal = '¿AHORA QUÉ HARÁS?';

  const canvas = document.getElementById('matrixCanvas');
  const ctx = canvas.getContext('2d');
  let width = canvas.width = window.innerWidth;
  let height = canvas.height = window.innerHeight;
  const fontSize = 14;
  const letras = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
  let drops;
  let matrixIntervals = [];

  function iniciarLluvia(velocidad = 50) {
    const columns = Math.floor(width / fontSize);
    drops = Array(columns).fill(1);

    const interval = setInterval(() => {
      ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
      ctx.fillRect(0, 0, width, height);
      ctx.fillStyle = '#0F0';
      ctx.font = `${fontSize}px monospace`;

      for (let i = 0; i < drops.length; i++) {
        const text = letras.charAt(Math.floor(Math.random() * letras.length));
        const x = i * fontSize;
        const y = drops[i] * fontSize;

        ctx.fillText(text, x, y);

        if (y > height && Math.random() > 0.975) {
          drops[i] = 0;
        }

        drops[i]++;
      }
    }, velocidad);

    matrixIntervals.push(interval);
  }

  function convertirATextoBinario(original, callback) {
    let iteration = 0;
    const maxIterations = 20;
    const length = original.length;

    const interval = setInterval(() => {
      let displayed = '';
      for (let i = 0; i < length; i++) {
        if (iteration >= maxIterations) {
          displayed += binary[Math.floor(Math.random() * binary.length)];
        } else {
          if (Math.random() < iteration / maxIterations) {
            displayed += binary[Math.floor(Math.random() * binary.length)];
          } else {
            displayed += original[i];
          }
        }
      }
      texto.textContent = displayed;
      iteration++;
      if (iteration > maxIterations) {
        clearInterval(interval);
        if (callback) callback();
      }
    }, 80);
  }

  function transformarANuevoTexto(nuevoTexto, callback) {
    let displayed = texto.textContent.split('');
    let target = nuevoTexto.split('');
    const length = Math.max(displayed.length, target.length);
    let index = 0;

    const interval = setInterval(() => {
      if (index >= length) {
        clearInterval(interval);
        texto.textContent = nuevoTexto;
        if (callback) callback();
        return;
      }

      for (let i = 0; i < length; i++) {
        if (i <= index) {
          displayed[i] = target[i] || ' ';
        } else {
          displayed[i] = numbers[Math.floor(Math.random() * numbers.length)];
        }
      }

      texto.textContent = displayed.join('');
      index++;
    }, 120);
  }

  btnHacker.addEventListener('click', () => {
    btnHacker.disabled = true;

    document.body.style.backgroundColor = 'black';
    document.body.style.color = '#00ff00';
    document.body.style.fontFamily = 'monospace';
    texto.style.fontFamily = 'monospace';

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    iniciarLluvia();

    convertirATextoBinario(texto.textContent, () => {
      transformarANuevoTexto(targetText, () => {
        setTimeout(() => {
          convertirATextoBinario(targetText, () => {
            transformarANuevoTexto(preguntaFinal, () => {
              opciones.style.display = 'flex';
            });
          });
        }, 1500);
      });
    });
  });

  btnArreglar.addEventListener('click', () => {
    document.body.style.backgroundColor = 'red';
    document.body.style.color = 'white';
    document.body.style.fontFamily = 'Arial, sans-serif';
    texto.style.fontFamily = 'Arial, sans-serif';
    texto.textContent = '¡Hola, mundo!';
    btnHacker.disabled = true;
    opciones.style.display = 'none';

    // Detener todas las lluvias
    matrixIntervals.forEach(interval => clearInterval(interval));
    matrixIntervals = [];
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  });

  btnHackearMas.addEventListener('click', () => {
    // Iniciar muchas lluvias superpuestas cada 1ms
    for (let i = 0; i < 1; i++) {
      setTimeout(() => iniciarLluvia(1), i * 50);
    }
  });

  window.addEventListener('resize', () => {
    width = canvas.width = window.innerWidth;
    height = canvas.height = window.innerHeight;
  });
</script>

</body>
</html>
